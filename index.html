<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Daily Food Quality & Taste Check — Konarak F&B</title>

<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

<style>
  body{ font-family:Arial,Helvetica,sans-serif; background:#f3f3f3; margin:0; padding:18px; }
  .page-wrap{ max-width:1000px; margin:auto; }
  .sheet{ border:3px solid #222; background:#fff; padding:12px; }
  .inner-box{ border:2px solid #222; padding:12px; }

  /* HEADER */
  .header{ position:relative; display:flex; align-items:center; height:60px; }
  .logo{ flex:0 0 auto; display:flex; align-items:center; }
  .logo img{ height:36px; width:auto; object-fit:contain; }
  @media(max-width:600px){ .logo img{ height:32px; } }
  .title{
    position:absolute; left:50%; transform:translateX(-50%);
    font-size:20px; font-weight:700;
  }
  .header-right{ flex:0 0 150px; }
  .header-line{ border-bottom:2px solid #222; margin:10px 0; }

  /* METADATA */
  .meta-box{ border:1px solid #222; padding:8px; }
  .meta-row{ display:flex; flex-wrap:wrap; gap:10px; margin-bottom:10px; }
  .meta-item{
    flex:1 1 30%;
    border:1px solid #999;
    padding:10px;
    display:flex; align-items:center; gap:6px;
    min-height:48px;
    box-sizing:border-box;
  }
  .meta-item label{
    font-weight:700; width:110px; flex-shrink:0; font-size:13px;
  }
  .meta-item input, .meta-item select{
    flex:1; padding:8px; border:1px solid #bbb; border-radius:3px; min-width:0;
  }

  /* TABLE */
  .table-wrap{ overflow:auto; margin-top:14px; }
  table{ width:100%; border-collapse:collapse; min-width:1100px; }
  th,td{ border:1px solid #222; padding:6px; font-size:13px; }
  th{ background:#eee; font-weight:700; }
  td input,td select{ width:100%; padding:6px; box-sizing:border-box; border:1px solid #bbb; }

  .after-table-gap{ height:16px; }

  /* HYGIENE CHECKLIST */
  .check-box{
    border:1px solid #222;
    padding:10px;
    margin-top:12px;
  }
  .check-title{ font-weight:700; font-size:15px; margin-bottom:8px; }
  .check-row{ display:flex; flex-wrap:wrap; gap:10px; }
  .check-item{
    flex:1 1 30%;
    border:1px solid #999;
    padding:10px;
    box-sizing:border-box;
    display:flex;
    align-items:center;
    gap:6px;
  }
  .check-item label{ width:110px; font-weight:700; }

  /* NOTES */
  .notes-area{
    display:flex; gap:8px; flex-wrap:wrap;
  }
  .note-box{
    flex:1 1 calc(33.33% - 8px);
    border:1px solid #222;
    padding:6px;
    box-sizing:border-box;
    background:#fff;
    min-height:82px;
  }
  .note-box label{ font-weight:700; margin-bottom:4px; display:block; }
  .note-box textarea{
    width:100%; min-height:58px; resize:vertical;
    padding:6px; border:1px solid #bbb; border-radius:3px;
  }

  /* FOOTER */
  .footer-box{ border:1px solid #222; margin-top:12px; display:flex; }
  .footer-half{
    flex:1;
    padding:10px;
    border-right:1px solid #ccc;
  }
  .footer-half:last-child{ border-right:none; }
  .footer-half input{
    width:95%; padding:8px; border:1px solid #bbb; border-radius:3px;
  }

  /* BUTTONS */
  .buttons{ display:flex; gap:12px; margin-top:14px; flex-wrap:wrap; }
  .btn{
    padding:10px 16px; color:#fff; border:none; border-radius:6px; font-weight:700;
    cursor:pointer;
  }
  .btn-add{ background:#0d6efd; }
  .btn-save{ background:#198754; }
  .btn-pdf{ background:#6f42c1; }
  .btn-reset{ background:#d9534f; }

</style>
</head>
<body>

<div class="page-wrap">
  <div class="sheet">
    <div class="inner-box">

      <!-- HEADER -->
      <div class="header">
        <div class="logo"><img id="logoImg" src="logo.png" alt=""></div>
        <div class="title">Daily Food Quality &amp; Taste Check Report</div>
        <div class="header-right"></div>
      </div>
      <div class="header-line"></div>

      <!-- METADATA -->
      <div class="meta-box">
        <div class="meta-row">
          <div class="meta-item"><label>Date:</label><input id="date" type="date"></div>
          <div class="meta-item"><label>Vendor Name:</label><input id="vendorName" type="text"></div>
          <div class="meta-item"><label>Vendor Supervisor:</label><input id="vendorSupervisor" type="text"></div>
        </div>
        <div class="meta-row">
          <div class="meta-item"><label>Building:</label><input id="building" type="text"></div>
          <div class="meta-item"><label>Floor:</label><input id="floor" type="text"></div>
          <div class="meta-item"><label>Counter:</label><input id="counter" type="text"></div>
        </div>
      </div>

      <!-- TABLE -->
      <div class="table-wrap">
        <table id="foodTable">
          <thead>
            <tr>
              <th>S.No</th><th>Item</th><th>Temp (°C)</th>
              <th>Freshness</th><th>Taste</th><th>Texture</th>
              <th>Appearance</th><th>Portion</th><th>Remarks</th><th>Del</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>1</td>
              <td><input></td>
              <td><input></td>
              <td><select><option>Good</option><option>Poor</option></select></td>
              <td><select><option>Good</option><option>Poor</option></select></td>
              <td><select><option>Normal</option><option>Hard</option></select></td>
              <td><select><option>Good</option><option>Poor</option></select></td>
              <td><select><option>Std</option><option>Less</option></select></td>
              <td><input></td>
              <td><button onclick="deleteRow(this)" class="btn btn-reset" style="padding:4px 6px;">X</button></td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="after-table-gap"></div>

      <!-- HYGIENE CHECKLIST -->
      <div class="check-box">
        <div class="check-title">Hygiene & Handling Checklist</div>

        <div class="check-row">
          <div class="check-item">
            <label>Hand Gloves:</label>
            <select id="chk_gloves"><option>Yes</option><option>No</option></select>
          </div>

          <div class="check-item">
            <label>Head Cap:</label>
            <select id="chk_cap"><option>Yes</option><option>No</option></select>
          </div>

          <div class="check-item">
            <label>Apron Clean:</label>
            <select id="chk_apron"><option>Yes</option><option>No</option></select>
          </div>
        </div>
      </div>

      <!-- NOTES -->
      <div class="notes-area">
        <div class="note-box"><label>Taste Validation Notes</label><textarea id="tasteNotes"></textarea></div>
        <div class="note-box"><label>Special Observations</label><textarea id="obsNotes"></textarea></div>
        <div class="note-box"><label>Corrective Actions</label><textarea id="actNotes"></textarea></div>
      </div>

      <!-- FOOTER -->
      <div class="footer-box">
        <div class="footer-half">
          <label>Vendor PoC :</label>
          <input id="vendorPoc">
        </div>

        <div class="footer-half">
          <label>Verified by F&B Team :</label>
          <input id="verifiedBy">
        </div>
      </div>

    </div>
  </div>

  <!-- BUTTONS -->
  <div class="buttons">
    <button class="btn btn-add" onclick="addRow()">Add Row</button>
    <button class="btn btn-save" onclick="saveForm()">Save</button>
    <button class="btn btn-pdf" onclick="downloadPDF()">Download PDF</button>
    <button class="btn btn-reset" onclick="resetForm()">Reset</button>
  </div>
</div>

<script>
function deleteRow(btn){
  let tr=btn.closest("tr");
  tr.remove();
  document.querySelectorAll("#foodTable tbody tr").forEach((r,i)=>r.cells[0].innerText=i+1);
}

function addRow(){
  const tbody=document.querySelector("#foodTable tbody");
  let i=tbody.rows.length+1;
  let tr=document.createElement("tr");
  tr.innerHTML=`
    <td>${i}</td>
    <td><input></td>
    <td><input></td>
    <td><select><option>Good</option><option>Poor</option></select></td>
    <td><select><option>Good</option><option>Poor</option></select></td>
    <td><select><option>Normal</option><option>Hard</option></select></td>
    <td><select><option>Good</option><option>Poor</option></select></td>
    <td><select><option>Std</option><option>Less</option></select></td>
    <td><input></td>
    <td><button class="btn btn-reset" onclick="deleteRow(this)" style="padding:4px 6px;">X</button></td>`;
  tbody.appendChild(tr);
}

/* Convert Yes/No to Green tick or Red cross */
function yesNoToSymbol(v){
  if(!v) return {text:"",color:[0,0,0]};
  v=v.toLowerCase();
  if(v==="yes" || v==="good"){
    return {text:"✓", color:[0,150,0]};
  }
  return {text:"✗", color:[200,0,0]};
}

/* PDF GENERATION */
async function downloadPDF(){
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({orientation:"landscape",unit:"pt",format:"a4"});

  const margin=22;
  const pageW=doc.internal.pageSize.getWidth();
  const usable=pageW - margin*2;
  let y=margin;

  let logo=await loadImage(document.getElementById("logoImg").src);

  if(logo){
    const targetH=42, scale=targetH/logo.height;
    let w=logo.width*scale, h=targetH;
    let maxW=usable*0.28;
    if(w>maxW){ const s=maxW/w; w*=s; h*=s; }
    doc.addImage(logo.data,"PNG",margin,y,w,h);
  }

  doc.setFont("helvetica","bold").setFontSize(18);
  doc.text("Daily Food Quality & Taste Check Report",pageW/2,y+26,{align:"center"});

  y+=60;
  doc.line(margin,y-6,pageW-margin,y-6);

  const meta=[
    ["Date",document.getElementById("date").value],
    ["Vendor Name",document.getElementById("vendorName").value],
    ["Vendor Supervisor",document.getElementById("vendorSupervisor").value],
    ["Building",document.getElementById("building").value],
    ["Floor",document.getElementById("floor").value],
    ["Counter",document.getElementById("counter").value]
  ];

  doc.setFontSize(10);
  const colW=(usable-10)/3;
  let x=margin;
  for(let i=0;i<3;i++){
    doc.rect(x,y,colW,34);
    doc.text(meta[i][0]+":",x+6,y+12);
    doc.text(doc.splitTextToSize(meta[i][1],colW-12),x+6,y+26);
    x+=colW+5;
  }
  y+=40;
  x=margin;
  for(let i=3;i<6;i++){
    doc.rect(x,y,colW,34);
    doc.text(meta[i][0]+":",x+6,y+12);
    doc.text(doc.splitTextToSize(meta[i][1],colW-12),x+6,y+26);
    x+=colW+5;
  }
  y+=46;

  /* TABLE */
  const rows=[...document.querySelectorAll("#foodTable tbody tr")].map((tr,i)=>{
    const c=tr.querySelectorAll("td");
    return [
      i+1,
      c[1].querySelector("input").value,
      c[2].querySelector("input").value,
      c[3].querySelector("select").value,
      c[4].querySelector("select").value,
      c[5].querySelector("select").value,
      c[6].querySelector("select").value,
      c[7].querySelector("select").value,
      c[8].querySelector("input").value
    ];
  });

  doc.autoTable({
    startY:y,
    head:[["S.No","Item","Temp (°C)","Freshness","Taste","Texture","Appearance","Portion","Remarks"]],
    body:rows,
    margin:{left:margin+5,right:margin+5},
    theme:"grid",
    styles:{fontSize:10,cellPadding:6},
    headStyles:{fillColor:[230,230,230]},
    columnStyles:{ 1:{cellWidth:210}, 8:{cellWidth:210} }
  });

  y=doc.lastAutoTable.finalY+18;

  /* HYGIENE CHECKLIST */
  const chk={
    gloves: yesNoToSymbol(document.getElementById("chk_gloves").value),
    cap: yesNoToSymbol(document.getElementById("chk_cap").value),
    apron: yesNoToSymbol(document.getElementById("chk_apron").value)
  };

  doc.setFont("helvetica","bold").setFontSize(12);
  doc.text("Hygiene & Handling Checklist",margin,y);
  y+=6;
  doc.rect(margin,y,usable,70);

  doc.setFontSize(11);

  // Gloves
  doc.setTextColor(0,0,0);
  doc.text("Hand Gloves:",margin+10,y+22);
  doc.setTextColor(...chk.gloves.color);
  doc.text(chk.gloves.text,margin+130,y+22);

  // Cap
  doc.setTextColor(0,0,0);
  doc.text("Head Cap:",margin+10,y+42);
  doc.setTextColor(...chk.cap.color);
  doc.text(chk.cap.text,margin+130,y+42);

  // Apron
  doc.setTextColor(0,0,0);
  doc.text("Apron Clean:",margin+10,y+62);
  doc.setTextColor(...chk.apron.color);
  doc.text(chk.apron.text,margin+130,y+62);

  doc.setTextColor(0,0,0);

  y+=86;

  /* NOTES */
  const notes=[
    ["Taste Validation Notes",document.getElementById("tasteNotes").value],
    ["Special Observations",document.getElementById("obsNotes").value],
    ["Corrective Actions",document.getElementById("actNotes").value]
  ];

  const gap=10,bw=(usable-gap*2)/3,bh=72;
  let nx=margin;

  notes.forEach(n=>{
    doc.rect(nx,y,bw,bh);
    doc.text(n[0],nx+6,y+14);
    doc.text(doc.splitTextToSize(n[1],bw-12),nx+6,y+30);
    nx+=bw+gap;
  });
  y+=bh+16;

  /* FOOTER */
  const v=document.getElementById("vendorPoc").value;
  const f=document.getElementById("verifiedBy").value;

  doc.rect(margin,y,usable,60);
  doc.line(margin+usable/2,y,margin+usable/2,y+60);
  doc.text("Vendor PoC : "+v,margin+10,y+26);
  doc.text("Verified by F&B Team : "+f,margin+usable/2+10,y+26);

  doc.save("Food_Quality_Check.pdf");

  function loadImage(src){
    return new Promise(res=>{
      const i=new Image();
      i.crossOrigin="anonymous";
      i.onload=function(){
        const c=document.createElement("canvas");
        c.width=this.width; c.height=this.height;
        c.getContext("2d").drawImage(this,0,0);
        res({data:c.toDataURL("image/png"),width:this.width,height:this.height});
      };
      i.onerror=()=>res(null);
      i.src=src;
    });
  }
}
</script>

</body>
</html>
