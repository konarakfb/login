<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Daily Food Quality & Taste Check — Konarak F&B</title>

<!-- html2canvas + jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
  /* Sheet (fixed capture width similar to your PDF sample) */
  body { font-family: Arial, Helvetica, sans-serif; background:#f2f2f2; padding:12px; }
  .page {
    width: 100%;
    max-width: 1000px;
    margin: auto;
    box-sizing: border-box;
  }
  .sheet {
    width: 820px;              /* fixed printable width for PDF capture */
    margin: auto;
    background: #fff;
    border: 2px solid #000;    /* outer full-width border like PDF */
    padding: 10px;
    box-sizing: border-box;
  }

  /* Header box with logo left + centered title */
  .header-box {
    border: 1px solid #000;
    padding: 8px 10px;
    display: flex;
    align-items: center;
    gap: 12px;
    flex-wrap: wrap;
  }
  .logo-area { flex: 0 0 110px; display:flex; align-items:center; justify-content:center; }
  .logo-area img { max-height:70px; width:auto; display:block; }
  .title-area { flex: 1 1 auto; text-align:center; font-weight:700; font-size:20px; }
  .header-space { flex:0 0 110px; } /* keeps header balanced */

  /* Meta rows below header: boxed single-row style like sample */
  .meta-row {
    display:flex;
    gap:8px;
    margin-top:8px;
    border: 1px solid #000;
    padding:6px;
    flex-wrap:wrap;
  }
  .meta-col { flex:1 1 220px; min-width:160px; box-sizing:border-box; padding:4px; border-right:1px solid #000; }
  .meta-col:last-child { border-right: none; }
  .meta-label { font-weight:700; font-size:13px; margin-bottom:4px; display:block; }
  .meta-value input { width:100%; padding:6px; font-size:13px; border:1px solid #666; border-radius:3px; box-sizing:border-box; }

  /* Table */
  .table-wrap { margin-top:12px; overflow-x:auto; }
  table { border-collapse:collapse; width:780px; /* fixed for PDF capture */ }
  th, td {
    border:1px solid #000; padding:6px; font-size:12px; vertical-align:middle;
    white-space:nowrap;
  }
  th { background:#e8e8e8; font-weight:700; text-align:center; }
  table input, table select { width:95%; padding:4px; font-size:12px; box-sizing:border-box; }

  /* Footer boxes */
  .footer { display:flex; gap:8px; margin-top:10px; }
  .footer .box { flex:1 1 300px; border:1px solid #000; padding:6px; min-height:36px; box-sizing:border-box; }

  /* Controls */
  .controls { display:flex; gap:8px; margin-top:10px; flex-wrap:wrap; }
  button { padding:10px 12px; font-size:14px; border:none; color:#fff; border-radius:4px; cursor:pointer; }
  .btn-add { background:#138000; }  /* green */
  .btn-save { background:#0b66c3; } /* blue */
  .btn-pdf  { background:#cc7a00; } /* orange */
  .btn-del  { background:#b30000; padding:4px 6px; font-size:12px; }

  /* Notes */
  .notes { margin-top:12px; }
  .notes label { font-weight:700; font-size:13px; display:block; margin-bottom:6px; }
  .notes textarea { width:100%; min-height:70px; padding:6px; box-sizing:border-box; border:1px solid #666; border-radius:3px; font-size:13px; }

  /* Responsive adjustments */
  @media (max-width:880px) {
    .sheet { width:100%; padding:8px; }
    table { width:720px; }
    .logo-area img { max-height:56px; }
  }
  @media (max-width:520px) {
    .logo-area { flex-basis:100%; order:1; }
    .title-area { order:2; width:100%; font-size:18px; }
    .header-space { display:none; }
    .meta-row { flex-direction:column; }
    .meta-col { min-width:100%; }
    .table-wrap { overflow-x:auto; }
  }
</style>
</head>

<body>
  <div class="page">
    <div class="sheet" id="sheet">

      <!-- HEADER: logo left + centered title inside header box -->
      <div class="header-box" role="banner">
        <div class="logo-area">
          <!-- Put cognizant logo file named logo.png in same folder -->
          <img src="logo.png" alt="Cognizant Logo" id="cogLogo" onerror="this.style.display='none'">
        </div>

        <div class="title-area">Daily Food Quality & Taste Check Report</div>

        <div class="header-space"></div>
      </div>

      <!-- METADATA (below header) - boxed single-row look -->
      <div class="meta-row" aria-label="metadata">
        <div class="meta-col">
          <div class="meta-label">Date</div>
          <div class="meta-value"><input type="date" id="date"></div>
        </div>
        <div class="meta-col">
          <div class="meta-label">Building</div>
          <div class="meta-value"><input type="text" id="building" placeholder="e.g. 12A"></div>
        </div>
        <div class="meta-col">
          <div class="meta-label">Floor / Counter</div>
          <div class="meta-value"><input type="text" id="floor" placeholder="e.g. 6th / Food Court"></div>
        </div>
        <div class="meta-col">
          <div class="meta-label">Supervisor</div>
          <div class="meta-value"><input type="text" id="supervisor" placeholder="Supervisor name"></div>
        </div>
        <div class="meta-col">
          <div class="meta-label">CBRE Representative</div>
          <div class="meta-value"><input type="text" id="cbre" placeholder="CBRE name (if present)"></div>
        </div>
      </div>

      <!-- TABLE: fixed width for PDF capture; horizontally scrollable on small screens -->
      <div class="table-wrap" aria-label="table area">
        <table id="foodTable" role="table" aria-label="Food quality items">
          <thead>
            <tr>
              <th style="width:42px">S.No</th>
              <th style="width:220px">Item</th>
              <th style="width:70px">Temp (°C)</th>
              <th style="width:90px">Freshness</th>
              <th style="width:80px">Taste</th>
              <th style="width:80px">Texture</th>
              <th style="width:80px">Appearance</th>
              <th style="width:70px">Portion</th>
              <th style="width:140px">Remarks</th>
              <th style="width:52px">Del</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>1</td>
              <td><input type="text" placeholder="Item name"></td>
              <td><input type="text" placeholder="e.g. 60"></td>
              <td>
                <select><option>Good</option><option>Average</option><option>Poor</option></select>
              </td>
              <td>
                <select><option>Good</option><option>Average</option><option>Poor</option></select>
              </td>
              <td>
                <select><option>Soft</option><option>Normal</option><option>Hard</option></select>
              </td>
              <td>
                <select><option>Good</option><option>Average</option><option>Poor</option></select>
              </td>
              <td>
                <select><option>Std</option><option>Less</option></select>
              </td>
              <td><input type="text"></td>
              <td><button class="btn-del" onclick="deleteRow(this)">X</button></td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Controls -->
      <div class="controls">
        <button class="btn-add" onclick="addRow()">+ Add Row</button>
        <button class="btn-save" onclick="saveForm()">Save (local)</button>
        <button class="btn-pdf" onclick="downloadPDF()">Download PDF</button>
      </div>

      <!-- Notes & Footer boxes -->
      <div class="notes">
        <label for="tasteNotes">Taste Validation Notes</label>
        <textarea id="tasteNotes" placeholder="Taste, salt level, spice level, texture notes..."></textarea>

        <label for="obs" style="margin-top:8px;">Special Observations</label>
        <textarea id="obs"></textarea>

        <label for="actions" style="margin-top:8px;">Corrective Actions</label>
        <textarea id="actions"></textarea>
      </div>

      <div class="footer" style="margin-top:10px;">
        <div class="box">Vendor PoC :</div>
        <div class="box">Verified by F&B team :</div>
      </div>

    </div>
  </div>

<script>
/* ===== Row add / delete ===== */
function addRow(){
  const tbody = document.querySelector("#foodTable tbody");
  const idx = tbody.rows.length + 1;
  const tr = document.createElement("tr");
  tr.innerHTML = `
    <td>${idx}</td>
    <td><input type="text" placeholder="Item name"></td>
    <td><input type="text"></td>
    <td><select><option>Good</option><option>Average</option><option>Poor</option></select></td>
    <td><select><option>Good</option><option>Average</option><option>Poor</option></select></td>
    <td><select><option>Soft</option><option>Normal</option><option>Hard</option></select></td>
    <td><select><option>Good</option><option>Average</option><option>Poor</option></select></td>
    <td><select><option>Std</option><option>Less</option></select></td>
    <td><input type="text"></td>
    <td><button class="btn-del" onclick="deleteRow(this)">X</button></td>
  `;
  tbody.appendChild(tr);
}

function deleteRow(btn){
  const tr = btn.closest("tr");
  tr.remove();
  // reindex
  const rows = document.querySelectorAll("#foodTable tbody tr");
  rows.forEach((r,i)=> r.cells[0].textContent = i+1);
}

/* ===== Save (localStorage) ===== */
function saveForm(){
  const data = {};
  data.meta = {
    date: document.getElementById("date").value,
    building: document.getElementById("building").value,
    floor: document.getElementById("floor").value,
    supervisor: document.getElementById("supervisor").value,
    cbre: document.getElementById("cbre").value
  };
  data.rows = Array.from(document.querySelectorAll("#foodTable tbody tr")).map(tr=>{
    // map input/select values in each row (excluding S.No and delete)
    const cells = tr.querySelectorAll("td");
    return {
      item: cells[1].querySelector("input") ? cells[1].querySelector("input").value : "",
      temp: cells[2].querySelector("input") ? cells[2].querySelector("input").value : "",
      freshness: cells[3].querySelector("select") ? cells[3].querySelector("select").value : "",
      taste: cells[4].querySelector("select") ? cells[4].querySelector("select").value : "",
      texture: cells[5].querySelector("select") ? cells[5].querySelector("select").value : "",
      appearance: cells[6].querySelector("select") ? cells[6].querySelector("select").value : "",
      portion: cells[7].querySelector("select") ? cells[7].querySelector("select").value : "",
      remarks: cells[8].querySelector("input") ? cells[8].querySelector("input").value : ""
    };
  });
  data.notes = {
    tasteNotes: document.getElementById("tasteNotes").value,
    obs: document.getElementById("obs").value,
    actions: document.getElementById("actions").value
  };
  localStorage.setItem("foodQualityForm_v1", JSON.stringify(data));
  alert("Form saved locally (browser storage).");
}

/* ===== PDF generation: capture sheet and slice to A4 pages ===== */
async function downloadPDF(){
  // Ensure date exists to avoid blank placeholders
  if(!document.getElementById("date").value){
    document.getElementById("date").value = new Date().toISOString().slice(0,10);
  }

  const sheet = document.getElementById("sheet");

  // html2canvas scale for crispness; we compress JPEG later to keep file small
  const scale = 2; // good balance of quality and size
  const canvas = await html2canvas(sheet, {
    scale: scale,
    useCORS: true,
    backgroundColor: "#ffffff"
  });

  const imgData = canvas.toDataURL("image/jpeg", 0.85);

  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF("p", "pt", "a4");
  const pageWidth = pdf.internal.pageSize.getWidth();
  const pageHeight = pdf.internal.pageSize.getHeight();

  // compute pixel-to-point conversion to fit width
  const imgProps = { width: canvas.width, height: canvas.height };
  const pxToPt = pageWidth / imgProps.width;
  const imgWidthPt = imgProps.width * pxToPt;
  const imgHeightPt = imgProps.height * pxToPt;

  if (imgHeightPt <= pageHeight - 20) {
    // single page
    pdf.addImage(imgData, "JPEG", 10, 10, imgWidthPt - 20, imgHeightPt - 20, undefined, 'FAST');
  } else {
    // multi-page slicing
    let remainingHeight = imgProps.height;
    let positionY = 0;
    const pageHeightPx = Math.floor((pageHeight) / pxToPt);

    while (remainingHeight > 0) {
      const pageCanvas = document.createElement("canvas");
      pageCanvas.width = imgProps.width;
      pageCanvas.height = Math.min(pageHeightPx, remainingHeight);
      const ctx = pageCanvas.getContext("2d");
      ctx.fillStyle = "#ffffff";
      ctx.fillRect(0,0,pageCanvas.width,pageCanvas.height);
      // draw slice
      ctx.drawImage(canvas, 0, positionY, pageCanvas.width, pageCanvas.height, 0, 0, pageCanvas.width, pageCanvas.height);

      const pageImgData = pageCanvas.toDataURL("image/jpeg", 0.85);
      const pageImgHeightPt = (pageCanvas.height * pxToPt);

      if (positionY > 0) pdf.addPage();
      pdf.addImage(pageImgData, "JPEG", 10, 10, pageWidth - 20, pageImgHeightPt - 20, undefined, 'FAST');

      remainingHeight -= pageHeightPx;
      positionY += pageHeightPx;
    }
  }

  // Download
  pdf.save("Food_Quality_Check.pdf");
}

/* ===== Load saved form (if present) ===== */
(function loadSaved(){
  try {
    const raw = localStorage.getItem("foodQualityForm_v1");
    if(!raw) return;
    const data = JSON.parse(raw);
    if(data.meta){
      document.getElementById("date").value = data.meta.date || "";
      document.getElementById("building").value = data.meta.building || "";
      document.getElementById("floor").value = data.meta.floor || "";
      document.getElementById("supervisor").value = data.meta.supervisor || "";
      document.getElementById("cbre").value = data.meta.cbre || "";
    }
    if(data.rows && data.rows.length){
      // clear existing rows
      const tbody = document.querySelector("#foodTable tbody");
      tbody.innerHTML = "";
      data.rows.forEach((r, i)=>{
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${i+1}</td>
          <td><input type="text" value="${escapeHtml(r.item || '')}"></td>
          <td><input type="text" value="${escapeHtml(r.temp || '')}"></td>
          <td><select><option ${r.freshness==='Good'?'selected':''}>Good</option><option ${r.freshness==='Average'?'selected':''}>Average</option><option ${r.freshness==='Poor'?'selected':''}>Poor</option></select></td>
          <td><select><option ${r.taste==='Good'?'selected':''}>Good</option><option ${r.taste==='Average'?'selected':''}>Average</option><option ${r.taste==='Poor'?'selected':''}>Poor</option></select></td>
          <td><select><option ${r.texture==='Soft'?'selected':''}>Soft</option><option ${r.texture==='Normal'?'selected':''}>Normal</option><option ${r.texture==='Hard'?'selected':''}>Hard</option></select></td>
          <td><select><option ${r.appearance==='Good'?'selected':''}>Good</option><option ${r.appearance==='Average'?'selected':''}>Average</option><option ${r.appearance==='Poor'?'selected':''}>Poor</option></select></td>
          <td><select><option ${r.portion==='Std'?'selected':''}>Std</option><option ${r.portion==='Less'?'selected':''}>Less</option></select></td>
          <td><input type="text" value="${escapeHtml(r.remarks || '')}"></td>
          <td><button class="btn-del" onclick="deleteRow(this)">X</button></td>
        `;
        tbody.appendChild(tr);
      });
    }
    if(data.notes){
      document.getElementById("tasteNotes").value = data.notes.tasteNotes || "";
      document.getElementById("obs").value = data.notes.obs || "";
      document.getElementById("actions").value = data.notes.actions || "";
    }
  } catch(e){ console.warn("Could not load saved form", e); }
})();

/* helper to escape HTML for loaded values */
function escapeHtml(str){
  return String(str).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;");
}
</script>

</body>
</html>
