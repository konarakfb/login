<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>CTS Cafeteria - Food Feedback Form</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- PDF LIBRARIES -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <!-- Firebase Libraries -->
  <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-auth-compat.js"></script>

  <style>
    :root{
      --accent:#f28c2b;
      --accent-soft:#fff3e6;
      --border:#000;
      --bg:#f4f4f4;
      --text:#111;
      --muted:#666;
    }

    *{box-sizing:border-box;}

    body{
      margin:0;
      font-family: Arial, system-ui;
      background:var(--bg);
      padding:12px;
      color:var(--text);
    }

    .wrapper{
      max-width:1100px;
      margin:0 auto;
    }

    /* Admin login bar */
    #admin-bar{
      max-width:1100px;
      margin:0 auto 10px;
      padding:8px;
      border-radius:8px;
      background:#fff8ef;
      border:1px solid #ffd4a8;
      font-size:12px;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }

    .admin-only{display:none;}
    body.is-admin .admin-only{display:inline-flex;}

    #admin-login-box input{
      padding:6px;
      border-radius:6px;
      border:1px solid #aaa;
      font-size:12px;
    }

    #admin-login-box button,
    #admin-logout-box button{
      padding:6px 12px;
      border-radius:999px;
      background:var(--accent);
      color:#fff;
      border:1px solid var(--accent);
      cursor:pointer;
      font-size:12px;
      font-weight:bold;
    }

    .top-bar{
      display:flex;
      justify-content:space-between;
      font-size:13px;
      margin-bottom:10px;
    }

    .sheet{
      background:#fff;
      border:1px solid var(--border);
      border-radius:10px;
      padding:20px;
    }

    .header-box{
      border:1px solid #000;
      padding:14px;
      border-radius:10px;
      margin-bottom:14px;
    }

    .header-row{
      display:flex;
      gap:12px;
      align-items:center;
    }

    .logo-box{
      width:70px;
      height:70px;
      border:1px solid #000;
      border-radius:8px;
      display:flex;
      align-items:center;
      justify-content:center;
    }

    .logo-box img{
      width:100%;
      height:100%;
      object-fit:contain;
    }

    .company-name{
      font-size:18px;
      font-weight:bold;
      color:var(--accent);
      margin:0;
      text-transform:uppercase;
    }

    .sub-title{
      margin:3px 0;
      font-weight:bold;
    }

    .form-title{
      margin:0;
      border-top:1px solid #000;
      padding-top:6px;
      text-align:center;
      color:var(--accent);
      font-size:16px;
      font-weight:bold;
      text-transform:uppercase;
    }

    .meta-row{
      display:grid;
      grid-template-columns:repeat(4,1fr);
      gap:10px;
      margin-top:10px;
      font-size:12px;
    }

    .meta-item label{
      font-weight:bold;
    }

    .meta-item input, .meta-item select{
      width:100%;
      padding:6px;
      border:1px solid #000;
      border-radius:4px;
    }

    .section-title{
      padding:6px;
      background:var(--accent-soft);
      border-left:4px solid var(--accent);
      margin-top:16px;
      font-weight:bold;
      text-transform:uppercase;
      font-size:13px;
    }

    .question-table{
      width:100%;
      border-collapse:collapse;
      margin-bottom:12px;
      font-size:12px;
    }

    .question-table th, .question-table td{
      border:1px solid #000;
      padding:6px;
    }

    .question-table th{
      background:#fff7ef;
      text-align:center;
    }

    .option-group{
      display:flex;
      flex-wrap:wrap;
      gap:12px;
    }

    .text-row{
      display:flex;
      gap:10px;
      margin-bottom:10px;
      font-size:12px;
    }

    .text-row label{
      width:150px;
      font-weight:bold;
    }

    .text-row textarea{
      flex:1;
      min-height:60px;
      border:1px solid #000;
      border-radius:4px;
      padding:6px;
    }

    .footer-note{
      margin-top:12px;
      border-top:1px solid #000;
      padding-top:6px;
      display:flex;
      justify-content:space-between;
      font-size:11px;
    }

    .actions{
      display:flex;
      gap:10px;
      justify-content:center;
      margin-top:14px;
    }

    .btn{
      padding:8px 20px;
      border-radius:999px;
      border:1px solid var(--accent);
      color:var(--accent);
      font-weight:bold;
      background:#fff;
      cursor:pointer;
    }

    .btn-primary{
      background:var(--accent);
      color:#fff;
    }
  </style>
</head>

<body>

<!-- ADMIN LOGIN BAR -->
<div id="admin-bar">
  <div id="admin-status">Mode: Public (Employee)</div>

  <div id="admin-login-box">
    <input type="email" id="admin-email" placeholder="Admin email">
    <input type="password" id="admin-password" placeholder="Password">
    <button onclick="adminLogin()">Login</button>
  </div>

  <div id="admin-logout-box" style="display:none;">
    <button onclick="adminLogout()">Logout</button>
  </div>
</div>

<div class="wrapper">

  <div class="top-bar">
    <div>Food Feedback Form</div>
    <div>Date: <span id="today-span"></span></div>
  </div>

  <div id="pdf-area" class="sheet">

    <!-- HEADER BLOCK (unchanged) -->
    <div class="header-box">
      <div class="header-row">
        <div class="logo-box"><img src="logo1.png"></div>
        <div>
          <h1 class="company-name">CTS CAFETERIA</h1>
          <p class="sub-title">Operated by Konarak Food & Beverages</p>
          <p class="form-title">FOOD FEEDBACK FORM</p>
        </div>
      </div>

      <div class="meta-row">
        <div class="meta-item">
          <label>Food Item Name</label>
          <input id="food-item">
        </div>
        <div class="meta-item">
          <label>Building</label>
          <input id="building">
        </div>
        <div class="meta-item">
          <label>Floor</label>
          <input id="floor">
        </div>
        <div class="meta-item">
          <label>Counter</label>
          <input id="counter">
        </div>
        <div class="meta-item">
          <label>Employee Name</label>
          <input id="emp-name">
        </div>
        <div class="meta-item">
          <label>Employee ID</label>
          <input id="emp-id">
        </div>
        <div class="meta-item">
          <label>Department</label>
          <input id="dept">
        </div>
        <div class="meta-item">
          <label>Meal Type</label>
          <select id="meal-type">
            <option>Select</option>
            <option>Breakfast</option>
            <option>Lunch</option>
            <option>Dinner</option>
            <option>Snacks</option>
          </select>
        </div>
      </div>
    </div>

    <!-- ALL OTHER SECTIONS REMAIN EXACTLY SAME -->

    <!-- FOOD QUALITY -->
    <div class="section-title">Food Quality</div>

    <table class="question-table">
      <thead><tr><th>Parameter</th><th>Feedback</th></tr></thead>
      <tbody>
        <tr>
          <td><b>Taste</b><br><small>Overall taste</small></td>
          <td><div class="option-group">
            <label><input type="radio" name="taste">Excellent</label>
            <label><input type="radio" name="taste">Good</label>
            <label><input type="radio" name="taste">Average</label>
            <label><input type="radio" name="taste">Poor</label>
          </div></td>
        </tr>

        <tr>
          <td><b>Freshness</b><br><small>Food freshness</small></td>
          <td><div class="option-group">
            <label><input type="radio" name="fresh">Yes</label>
            <label><input type="radio" name="fresh">Partially</label>
            <label><input type="radio" name="fresh">No</label>
          </div></td>
        </tr>

        <tr>
          <td><b>Temperature</b><br><small>Hot/warm/cold</small></td>
          <td><div class="option-group">
            <label><input type="radio" name="temp">Hot</label>
            <label><input type="radio" name="temp">Warm</label>
            <label><input type="radio" name="temp">Cold</label>
          </div></td>
        </tr>

        <tr>
          <td><b>Portion Size</b></td>
          <td><div class="option-group">
            <label><input type="radio" name="portion">Adequate</label>
            <label><input type="radio" name="portion">More</label>
            <label><input type="radio" name="portion">Less</label>
          </div></td>
        </tr>

        <tr>
          <td><b>Variety</b></td>
          <td><div class="option-group">
            <label><input type="radio" name="variety">Very Good</label>
            <label><input type="radio" name="variety">Good</label>
            <label><input type="radio" name="variety">Needs Improvement</label>
            <label><input type="radio" name="variety">Poor</label>
          </div></td>
        </tr>
      </tbody>
    </table>

    <!-- HYGIENE -->
    <div class="section-title">Hygiene & Service</div>

    <table class="question-table">
      <tbody>
        <tr>
          <td><b>Staff Behaviour</b></td>
          <td><div class="option-group">
            <label><input type="radio" name="staff">Excellent</label>
            <label><input type="radio" name="staff">Good</label>
            <label><input type="radio" name="staff">Average</label>
            <label><input type="radio" name="staff">Poor</label>
          </div></td>
        </tr>

        <tr>
          <td><b>Cafeteria Cleanliness</b></td>
          <td><div class="option-group">
            <label><input type="radio" name="clean">Very Clean</label>
            <label><input type="radio" name="clean">Clean</label>
            <label><input type="radio" name="clean">Needs Improvement</label>
            <label><input type="radio" name="clean">Poor</label>
          </div></td>
        </tr>

        <tr>
          <td><b>Food Handling Hygiene</b></td>
          <td><div class="option-group">
            <label><input type="radio" name="hygiene">Good</label>
            <label><input type="radio" name="hygiene">Satisfactory</label>
            <label><input type="radio" name="hygiene">Needs Improvement</label>
          </div></td>
        </tr>
      </tbody>
    </table>

    <!-- COMMENTS -->
    <div class="section-title">Additional Comments</div>

    <div class="text-row">
      <label>What did you like most?</label>
      <textarea id="likes"></textarea>
    </div>

    <div class="text-row">
      <label>Suggestions for improvement</label>
      <textarea id="improve"></textarea>
    </div>

    <!-- OVERALL -->
    <div class="section-title">Overall Rating</div>

    <div class="text-row">
      <label>Overall Rating</label>
      <div class="option-group">
        <label><input type="radio" name="overall">1</label>
        <label><input type="radio" name="overall">2</label>
        <label><input type="radio" name="overall">3</label>
        <label><input type="radio" name="overall">4</label>
        <label><input type="radio" name="overall">5</label>
      </div>
    </div>

    <div class="text-row">
      <label>Signature</label>
      <textarea id="signature"></textarea>
    </div>

    <div class="footer-note">
      <span>Thank you for your valuable feedback.</span>
      <span><b>Form Code: KFB-001</b></span>
    </div>

  </div>

  <!-- BUTTONS -->
  <div class="actions">
    <button class="btn btn-primary" onclick="saveForm()">Save (Lock)</button>
    <button class="btn" onclick="resetForm()">Reset</button>

    <button class="btn admin-only" onclick="window.print()">Print</button>
    <button class="btn btn-primary admin-only" onclick="downloadPDF()">Download PDF</button>
  </div>

</div>

<script>
/* ---------- DATE ---------- */
document.getElementById("today-span").textContent =
  new Date().toLocaleDateString("en-GB");

/* ---------- SAVE LOCK ---------- */
function saveForm(){
  document.querySelectorAll("#pdf-area input, #pdf-area textarea, #pdf-area select")
    .forEach(el => el.setAttribute("disabled","disabled"));
  alert("Form saved & locked");
}

/* ---------- RESET ---------- */
function resetForm(){
  const els = document.querySelectorAll("#pdf-area input, #pdf-area textarea, #pdf-area select");
  els.forEach(el=>{
    el.removeAttribute("disabled");
    if(el.tagName==="TEXTAREA") el.value="";
    if(el.tagName==="SELECT") el.selectedIndex=0;
    if(el.type==="radio") el.checked=false;
    if(el.type==="text") el.value="";
  });
}

/* ---------- HD PDF WITH MARGINS ---------- */
function downloadPDF(){
  const { jsPDF } = window.jspdf;
  const area = document.getElementById("pdf-area");

  html2canvas(area,{scale:3,useCORS:true,scrollY:-window.scrollY,background:"#ffffff"})
    .then(canvas=>{
      const pdf = new jsPDF("p","mm","a4");
      const pageWidth = pdf.internal.pageSize.getWidth();
      const pageHeight = pdf.internal.pageSize.getHeight();

      const margin = 10;
      const imgWidth = pageWidth - margin*2;

      const pxPerMm = canvas.width/imgWidth;
      const pagePx = (pageHeight - margin*2)*pxPerMm;

      let y = 0;
      let page = 0;

      while(y < canvas.height){
        const pageCanvas = document.createElement("canvas");
        pageCanvas.width = canvas.width;
        pageCanvas.height = Math.min(pagePx, canvas.height - y);

        pageCanvas.getContext("2d").drawImage(
          canvas,0,y,canvas.width,pageCanvas.height,0,0,canvas.width,pageCanvas.height
        );

        const img = pageCanvas.toDataURL("image/png",1.0);
        const imgHeight = pageCanvas.height/pxPerMm;

        if(page>0) pdf.addPage();
        pdf.addImage(img,"PNG",margin,margin,imgWidth,imgHeight);

        y += pagePx;
        page++;
      }

      pdf.save("Food_Feedback_Form_KFB-001.pdf");
    });
}

/* ---------- FIREBASE ADMIN LOGIN ---------- */
const firebaseConfig = {
  apiKey: "AIzaSyDrbNwfwumTWXhAs6ZZ_ulcb5mO0NKeKso",
  authDomain: "konarak-feedback.firebaseapp.com",
  projectId: "konarak-feedback",
  storageBucket: "konarak-feedback.firebasestorage.app",
  messagingSenderId: "203063167708",
  appId: "1:203063167708:web:d5662effdfdf1815000219"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();

function adminLogin(){
  const email = document.getElementById("admin-email").value;
  const pass = document.getElementById("admin-password").value;

  auth.signInWithEmailAndPassword(email, pass)
  .catch(err=>alert("Login failed: " + err.message));
}

function adminLogout(){
  auth.signOut();
}

auth.onAuthStateChanged(user=>{
  const status = document.getElementById("admin-status");
  const boxIn = document.getElementById("admin-login-box");
  const boxOut = document.getElementById("admin-logout-box");

  if(user){
    document.body.classList.add("is-admin");
    status.textContent="Mode: ADMIN";
    boxIn.style.display="none";
    boxOut.style.display="block";
  }else{
    document.body.classList.remove("is-admin");
    status.textContent="Mode: Public (Employee)";
    boxIn.style.display="flex";
    boxOut.style.display="none";
  }
});
</script>

</body>
</html>
