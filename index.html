<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>CTS Cafeteria — Operated by Konarak</title>

<style>
  :root{
    --accent:#f28c2b;
    --bg:#f3f3f3;
    --card-soft:#faf7f3;
  }

  body{
    font-family:Arial,Helvetica,sans-serif;
    margin:20px;
    background:var(--bg);
    color:#111;
  }

  h2{
    text-align:center;
    margin-bottom:8px;
  }

  h3.subheading{
    text-align:center;
    margin-top:0;
    margin-bottom:20px;
    font-weight:600;
    color:#444;
  }

  .menu{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
    gap:18px;
  }

  .card{
    background:var(--card-soft);
    border:1px solid #ddd;
    border-radius:12px;
    padding:14px;
    text-align:center;
    box-shadow:0 2px 6px rgba(0,0,0,0.1);
  }

  .card img{
    width:100%;
    height:120px;
    object-fit:cover;
    border-radius:8px;
  }

  .name{
    font-size:15px;
    font-weight:bold;
    margin-top:8px;
  }

  .price{
    font-size:16px;
    font-weight:700;
    margin:4px 0;
  }

  .buybtn{
    background:var(--accent);
    color:#fff;
    padding:8px 12px;
    border-radius:8px;
    cursor:pointer;
    border:0;
    margin-top:6px;
    font-size:14px;
  }

  /* QR POPUP */
  #qrPopup{
    position:fixed; inset:0; background:rgba(0,0,0,0.6);
    display:none; align-items:center; justify-content:center; z-index:9999;
  }

  #qrBox{
    background:#fff; padding:20px; width:330px;
    border-radius:12px; text-align:center;
  }

  #qrBox img{ width:250px; height:250px; }

  /* TOKEN POPUP */
  #tokenPopup{
    position:fixed; inset:0; background:rgba(0,0,0,0.6);
    display:none; align-items:center; justify-content:center; z-index:99999;
  }

  #tokenBox{
    background:#fff; padding:22px; width:300px;
    border-radius:12px; text-align:center;
    box-shadow:0 4px 12px rgba(0,0,0,.25);
  }

</style>
</head>

<body>

<h2>CTS Cafeteria — Operated by Konarak</h2>
<h3 class="subheading">Nilgiri Cafe</h3>

<div class="menu" id="menuContainer"></div>

<!-- QR Popup -->
<div id="qrPopup">
  <div id="qrBox">
    <h3 id="qrTitle">Scan & Pay</h3>
    <img id="qrImage" src="phonepe_qr.png">
    <button id="paidBtn" class="buybtn">Paid — Get Token</button>
    <button class="buybtn" onclick="closeQr()" style="background:#666;margin-top:6px;">Cancel</button>
  </div>
</div>

<!-- TOKEN POPUP -->
<div id="tokenPopup">
  <div id="tokenBox">
    <h3>Payment Recorded</h3>
    <p id="tokenNumber" style="font-size:22px;font-weight:bold;margin:10px 0;"></p>
    <button class="buybtn" onclick="closeToken()">OK</button>
  </div>
</div>

<script>
/* GOOGLE FORM CONFIG (UPDATED ID) */
const GOOGLE_FORM_BASE =
 "https://docs.google.com/forms/d/e/1FAIpQLSdPFEHgyH5qnzyuuXHeHMY_OPEQ9YzktjSkz5yM-eg_dKQY9Q/formResponse";

const ENTRY_ITEM  = "entry.257563989";
const ENTRY_TOKEN = "entry.926383089";
const ENTRY_AMT   = "entry.677818799";

const TOKEN_PREFIX = "KFB";
const TOKEN_DIGITS = 6;

/* PRODUCT LIST WITH IMAGES */
const products = [
  { name:"Tea", price:12, img:"tea.jpg" },
  { name:"Dum Chai", price:12, img:"dum_chai.jpg" },
  { name:"Ginger Tea", price:15, img:"ginger_tea.jpg" },
  { name:"Lemon Tea", price:12, img:"lemon_tea.jpg" },
  { name:"Green Tea", price:18, img:"green_tea.jpg" },

  { name:"Coffee", price:15, img:"coffee.jpg" },
  { name:"Boost", price:18, img:"boost.jpg" },
  { name:"Horlicks", price:18, img:"horlicks.jpg" },
  { name:"Bournvita", price:18, img:"bournvita.jpg" },

  { name:"Biscuits (2Pc)", price:10, img:"biscuits.jpg" },
  { name:"Onion Samosa (1Pc)", price:7, img:"onion_samosa.jpg" },
  { name:"Corn Samosa (1Pc)", price:8, img:"corn_samosa.jpg" },
  { name:"Paneer Samosa (1Pc)", price:8, img:"paneer_samosa.jpg" },

  { name:"Bellam Tea", price:20, img:"bellam_tea.jpg" },
  { name:"Bellam Coffee", price:20, img:"bellam_coffee.jpg" },
  { name:"Ginger Coffee", price:20, img:"ginger_coffee.jpg" }
];

/* RENDER MENU */
const menuContainer=document.getElementById('menuContainer');

products.forEach((p,idx)=>{
  const card=document.createElement('div');
  card.className="card";
  card.innerHTML=`
    <img src="${p.img}">
    <div class="name">${p.name}</div>
    <div class="price">₹${p.price}</div>
    <button class="buybtn" onclick="onBuy(${idx})">Add</button>
  `;
  menuContainer.appendChild(card);
});

/* TOKEN COUNTER */
const LS_KEY='kiosk_kfb_counter_v1';
if(!localStorage.getItem(LS_KEY)) localStorage.setItem(LS_KEY,"1");

function getNextToken(){
  let n=parseInt(localStorage.getItem(LS_KEY),10);
  const token = TOKEN_PREFIX + String(n).padStart(TOKEN_DIGITS,'0');
  localStorage.setItem(LS_KEY, n+1);
  return token;
}

let selectedProduct=null;

function onBuy(idx){
  selectedProduct=products[idx];
  document.getElementById('qrTitle').innerText =
    `${selectedProduct.name} — ₹${selectedProduct.price}`;
  document.getElementById('qrPopup').style.display='flex';
}

function closeQr(){ document.getElementById('qrPopup').style.display='none'; }

function closeToken(){ document.getElementById('tokenPopup').style.display='none'; }

/* PAYMENT */
document.getElementById('paidBtn').addEventListener('click',()=>{

  const token=getNextToken();

  const params=new URLSearchParams();
  params.append(ENTRY_ITEM, selectedProduct.name);
  params.append(ENTRY_TOKEN, token);
  params.append(ENTRY_AMT, selectedProduct.price);

  const iframe=document.createElement('iframe');
  iframe.style.display='none';
  iframe.src = GOOGLE_FORM_BASE + "?" + params.toString();
  document.body.appendChild(iframe);

  closeQr();

  document.getElementById("tokenNumber").innerText = "Your Token: " + token;
  document.getElementById("tokenPopup").style.display = "flex";

  setTimeout(()=>document.body.removeChild(iframe),4000);
});
</script>

</body>
</html>

