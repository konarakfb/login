<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>CTS Cafeteria - Food Feedback Form</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- PDF LIBRARIES -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <!-- Firebase Libraries -->
  <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-auth-compat.js"></script>

  <style>
    :root{
      --accent:#f28c2b;
      --accent-soft:#fff3e6;
      --border:#000;
      --bg:#f4f4f4;
      --text:#111;
      --muted:#666;
    }

    *{box-sizing:border-box;}

    body{
      margin:0;
      font-family: Arial, system-ui, sans-serif;
      background:var(--bg);
      padding:12px;
      color:var(--text);
    }

    .wrapper{
      max-width:1100px;
      margin:0 auto;
    }

    /* ADMIN LOGIN BAR */
    .admin-bar{
      max-width:1100px;
      margin:0 auto 10px;
      padding:8px 10px;
      background:#fff7ef;
      border:1px solid #f2d1a8;
      border-radius:8px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-size:12px;
    }

    .admin-controls{
      display:flex;
      gap:6px;
      flex-wrap:wrap;
    }

    .admin-controls input{
      padding:6px 8px;
      border:1px solid #ddd;
      border-radius:6px;
      font-size:12px;
    }

    .admin-controls button{
      padding:6px 12px;
      background:var(--accent);
      border-radius:999px;
      border:1px solid var(--accent);
      color:#fff;
      cursor:pointer;
      font-size:12px;
      font-weight:bold;
    }

    .admin-controls button.secondary{
      background:#fff;
      color:var(--accent);
    }

    .top-bar{
      display:flex;
      justify-content:space-between;
      font-size:13px;
      margin-bottom:10px;
    }

    .sheet{
      background:#fff;
      padding:20px;
      border:1px solid var(--border);
      border-radius:10px;
    }

    .header-box{
      border:1px solid #000;
      padding:14px;
      border-radius:10px;
      margin-bottom:14px;
    }

    .header-row{
      display:flex;
      align-items:center;
      gap:12px;
    }

    .logo-box{
      width:70px;
      height:70px;
      border:1px solid #000;
      border-radius:8px;
      display:flex;
      justify-content:center;
      align-items:center;
    }

    .logo-box img{
      width:100%;
      height:100%;
      object-fit:contain;
    }

    .company-name{
      font-size:18px;
      font-weight:bold;
      margin:0;
      color:var(--accent);
    }

    .sub-title{
      margin:2px 0;
      font-weight:bold;
      font-size:14px;
    }

    .form-title{
      text-align:center;
      margin-top:6px;
      padding-top:6px;
      border-top:1px solid #000;
      color:var(--accent);
      font-weight:bold;
      text-transform:uppercase;
    }

    .meta-row{
      display:grid;
      grid-template-columns:repeat(4,1fr);
      gap:10px;
      margin-top:10px;
    }

    .meta-item label{
      font-size:12px;
      font-weight:bold;
    }

    .meta-item input, .meta-item select{
      width:100%;
      padding:6px;
      border:1px solid #000;
      border-radius:5px;
      margin-top:3px;
      font-size:12px;
    }

    .section-title{
      padding:6px;
      background:var(--accent-soft);
      border-left:4px solid var(--accent);
      margin-top:14px;
      font-weight:bold;
      text-transform:uppercase;
      font-size:13px;
    }

    .question-table{
      width:100%;
      border-collapse:collapse;
      font-size:12px;
      margin-bottom:10px;
    }
    .question-table th, .question-table td{
      border:1px solid #000;
      padding:6px;
      vertical-align:top;
    }
    .question-table th{
      background:#fff7ef;
      text-align:center;
    }

    .option-group{
      display:flex;
      flex-wrap:wrap;
      gap:12px;
    }

    .text-row{
      display:flex;
      gap:10px;
      margin-bottom:10px;
    }
    .text-row label{
      width:140px;
      font-size:12px;
      font-weight:bold;
    }
    .text-row textarea{
      flex:1;
      min-height:60px;
      border:1px solid #000;
      border-radius:5px;
      padding:6px;
    }

    .footer-note{
      border-top:1px solid #000;
      padding-top:8px;
      margin-top:12px;
      display:flex;
      justify-content:space-between;
      font-size:11px;
    }

    .actions{
      display:flex;
      justify-content:center;
      gap:10px;
      margin-top:16px;
      flex-wrap:wrap;
    }

    .btn{
      padding:8px 20px;
      border-radius:999px;
      border:1px solid var(--accent);
      background:#fff;
      color:var(--accent);
      font-weight:bold;
      cursor:pointer;
    }
    .btn-primary{
      background:var(--accent);
      color:#fff;
    }

    /* ADMIN ONLY BUTTONS */
    .admin-only{ display:none; }
    body.is-admin .admin-only{ display:inline-flex; }

    @media(max-width:768px){
      .meta-row{grid-template-columns:repeat(2,1fr);}
      .admin-bar{flex-direction:column;gap:8px;}
    }
    @media(max-width:480px){
      .meta-row{grid-template-columns:1fr;}
    }
  </style>
</head>

<body>

<!-- ADMIN LOGIN BAR -->
<div class="admin-bar">
  <div id="admin-status"><b>Mode:</b> Public (Employee)</div>

  <div class="admin-controls" id="login-box">
    <input type="email" id="email" placeholder="Admin email">
    <input type="password" id="password" placeholder="Password">
    <button onclick="adminLogin()">Login</button>
  </div>

  <div class="admin-controls" id="logout-box" style="display:none;">
    <span>Logged in as Admin</span>
    <button class="secondary" onclick="adminLogout()">Logout</button>
  </div>
</div>

<div class="wrapper">

  <div class="top-bar">
    <span>Food Feedback Form</span>
    <span id="today-span"></span>
  </div>

  <!-- START FORM AREA -->
  <div id="pdf-area" class="sheet">

    <div class="header-box">
      <div class="header-row">
        <div class="logo-box">
          <img src="logo1.png">
        </div>
        <div>
          <h1 class="company-name">CTS CAFETERIA</h1>
          <p class="sub-title">Operated by Konarak Food & Beverages</p>
          <p class="form-title">FOOD FEEDBACK FORM</p>
        </div>
      </div>

      <div class="meta-row">

        <div class="meta-item">
          <label>Food Item Name</label>
          <input id="food-item" type="text">
        </div>

        <div class="meta-item">
          <label>Building</label>
          <input id="building" type="text">
        </div>

        <div class="meta-item">
          <label>Floor</label>
          <input id="floor" type="text">
        </div>

        <div class="meta-item">
          <label>Counter</label>
          <input id="counter" type="text">
        </div>

        <div class="meta-item">
          <label>Employee Name</label>
          <input id="emp-name" type="text">
        </div>

        <div class="meta-item">
          <label>Employee ID</label>
          <input id="emp-id" type="text">
        </div>

        <div class="meta-item">
          <label>Department</label>
          <input id="dept" type="text">
        </div>

        <div class="meta-item">
          <label>Meal Type</label>
          <select id="meal-type">
            <option value="">Select</option>
            <option>Breakfast</option>
            <option>Lunch</option>
            <option>Dinner</option>
            <option>Snacks</option>
          </select>
        </div>

      </div>
    </div>

    <!-- FOOD QUALITY -->
    <div class="section-title">Food Quality</div>

    <table class="question-table">
      <thead>
        <tr><th>Parameter</th><th>Feedback</th></tr>
      </thead>
      <tbody>
        <tr>
          <td><b>Taste</b><br><small>Overall taste of the food served.</small></td>
          <td>
            <div class="option-group">
              <label><input type="radio" name="taste"> Excellent</label>
              <label><input type="radio" name="taste"> Good</label>
              <label><input type="radio" name="taste"> Average</label>
              <label><input type="radio" name="taste"> Poor</label>
            </div>
          </td>
        </tr>

        <tr>
          <td><b>Freshness</b><br><small>Was the food fresh?</small></td>
          <td>
            <div class="option-group">
              <label><input type="radio" name="fresh"> Yes</label>
              <label><input type="radio" name="fresh"> Partially</label>
              <label><input type="radio" name="fresh"> No</label>
            </div>
          </td>
        </tr>

        <tr>
          <td><b>Temperature</b><br><small>Hot / Warm / Cold</small></td>
          <td>
            <div class="option-group">
              <label><input type="radio" name="temp"> Hot</label>
              <label><input type="radio" name="temp"> Warm</label>
              <label><input type="radio" name="temp"> Cold</label>
            </div>
          </td>
        </tr>

        <tr>
          <td><b>Portion Size</b><br><small>Quantity served</small></td>
          <td>
            <div class="option-group">
              <label><input type="radio" name="portion"> Adequate</label>
              <label><input type="radio" name="portion"> More</label>
              <label><input type="radio" name="portion"> Less</label>
            </div>
          </td>
        </tr>

        <tr>
          <td><b>Variety</b><br><small>Menu options</small></td>
          <td>
            <div class="option-group">
              <label><input type="radio" name="variety"> Very Good</label>
              <label><input type="radio" name="variety"> Good</label>
              <label><input type="radio" name="variety"> Needs Improvement</label>
              <label><input type="radio" name="variety"> Poor</label>
            </div>
          </td>
        </tr>

      </tbody>
    </table>

    <!-- HYGIENE -->
    <div class="section-title">Hygiene & Service</div>

    <table class="question-table">
      <tbody>
        <tr>
          <td><b>Staff Behaviour</b><br><small>Politeness & support</small></td>
          <td>
            <div class="option-group">
              <label><input type="radio" name="staff"> Excellent</label>
              <label><input type="radio" name="staff"> Good</label>
              <label><input type="radio" name="staff"> Average</label>
              <label><input type="radio" name="staff"> Poor</label>
            </div>
          </td>
        </tr>

        <tr>
          <td><b>Cafeteria Cleanliness</b><br><small>Environment hygiene</small></td>
          <td>
            <div class="option-group">
              <label><input type="radio" name="clean"> Very Clean</label>
              <label><input type="radio" name="clean"> Clean</label>
              <label><input type="radio" name="clean"> Needs Improvement</label>
              <label><input type="radio" name="clean"> Poor</label>
            </div>
          </td>
        </tr>

        <tr>
          <td><b>Food Handling Hygiene</b><br><small>Gloves, apron, cap</small></td>
          <td>
            <div class="option-group">
              <label><input type="radio" name="hygiene"> Good</label>
              <label><input type="radio" name="hygiene"> Satisfactory</label>
              <label><input type="radio" name="hygiene"> Needs Improvement</label>
            </div>
          </td>
        </tr>

      </tbody>
    </table>

    <!-- COMMENTS -->
    <div class="section-title">Additional Comments</div>

    <div class="text-row">
      <label>What did you like most?</label>
      <textarea id="likes"></textarea>
    </div>

    <div class="text-row">
      <label>Suggestions for improvement</label>
      <textarea id="improve"></textarea>
    </div>

    <!-- OVERALL -->
    <div class="section-title">Overall Rating</div>

    <div class="text-row">
      <label>Rating</label>
      <div class="option-group">
        <label><input type="radio" name="overall"> 1</label>
        <label><input type="radio" name="overall"> 2</label>
        <label><input type="radio" name="overall"> 3</label>
        <label><input type="radio" name="overall"> 4</label>
        <label><input type="radio" name="overall"> 5</label>
      </div>
    </div>

    <div class="text-row">
      <label>Signature</label>
      <textarea id="signature"></textarea>
    </div>

    <div class="footer-note">
      <span>Thank you for your valuable feedback.</span>
      <span><b>Form Code: KFB-001</b></span>
    </div>

  </div>

  <!-- BUTTONS -->
  <div class="actions">
    <button class="btn btn-primary" onclick="saveForm()">Save (Lock)</button>
    <button class="btn" onclick="resetForm()">Reset</button>

    <!-- ADMIN ONLY -->
    <button class="btn admin-only" onclick="window.print()">Print</button>
    <button class="btn btn-primary admin-only" onclick="downloadPDF()">Download PDF</button>
  </div>

</div>

<script>
/* ------------------- SHOW TODAY DATE ------------------- */
document.getElementById("today-span").textContent =
  new Date().toLocaleDateString("en-GB");

/* ------------------- SAVE (LOCK FIELDS) ------------------- */
function saveForm(){
  document.querySelectorAll("#pdf-area input, #pdf-area textarea, #pdf-area select")
    .forEach(el => el.setAttribute("disabled","disabled"));

  alert("Saved! Form locked.");
}

/* ------------------- RESET (UNLOCK + CLEAR) ------------------- */
function resetForm(){
  const fields = document.querySelectorAll("#pdf-area input, #pdf-area textarea, #pdf-area select");

  fields.forEach(el=>{
    el.removeAttribute("disabled");

    if(el.tagName==="TEXTAREA") el.value="";
    if(el.tagName==="SELECT") el.selectedIndex=0;
    if(el.type==="radio") el.checked=false;
    if(el.type==="text") el.value="";
  });

  alert("Form cleared & unlocked.");
}

/* ------------------- HD MULTI-PAGE PDF (Margin Fix) ------------------- */
function downloadPDF() {
  const { jsPDF } = window.jspdf;
  const pdfArea = document.getElementById("pdf-area");

  html2canvas(pdfArea, {
    scale: 3,
    useCORS: true,
    scrollY: -window.scrollY,
    backgroundColor: "#ffffff"
  }).then(canvas => {

    const pdf = new jsPDF("p", "mm", "a4");

    const pageWidth = pdf.internal.pageSize.getWidth();
    const pageHeight = pdf.internal.pageSize.getHeight();

    const margin = 10;  
    const imgWidth = pageWidth - margin * 2;

    const pxPerMm = canvas.width / imgWidth;
    const imgHeight = canvas.height / pxPerMm;

    let y = 0;
    let page = 0;

    const pagePixelHeight = (pageHeight - margin * 2) * pxPerMm;

    while (y < canvas.height) {
      const pageCanvas = document.createElement("canvas");
      pageCanvas.width = canvas.width;
      pageCanvas.height = Math.min(pagePixelHeight, canvas.height - y);

      const context = pageCanvas.getContext("2d");
      context.drawImage(
        canvas,
        0, y,
        canvas.width, pageCanvas.height,
        0, 0,
        canvas.width, pageCanvas.height
      );

      const image = pageCanvas.toDataURL("image/png", 1.0);
      const imageHeightMm = pageCanvas.height / pxPerMm;

      if (page > 0) pdf.addPage();

      pdf.addImage(image, "PNG", margin, margin, imgWidth, imageHeightMm);
      y += pagePixelHeight;
      page++;
    }

    pdf.save("Food_Feedback_Form_KFB-001.pdf");
  });
}

/* ------------------- FIREBASE ADMIN LOGIN ------------------- */
const firebaseConfig = {
  apiKey: "AIzaSyDrbNwfwumTWXhAs6ZZ_ulcb5mO0NKeKso",
  authDomain: "konarak-feedback.firebaseapp.com",
  projectId: "konarak-feedback",
  storageBucket: "konarak-feedback.firebasestorage.app",
  messagingSenderId: "203063167708",
  appId: "1:203063167708:web:d5662effdfdf1815000219"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();

function adminLogin(){
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;

  auth.signInWithEmailAndPassword(email, password)
    .then(()=>{})
    .catch(err => alert("Login failed: " + err.message));
}

function adminLogout(){
  auth.signOut();
}

auth.onAuthStateChanged(user => {
  const status = document.getElementById("admin-status");
  const loginBox = document.getElementById("login-box");
  const logoutBox = document.getElementById("logout-box");

  if(user){
    document.body.classList.add("is-admin");
    status.innerHTML = "<b>Mode:</b> ADMIN";
    loginBox.style.display="none";
    logoutBox.style.display="flex";
  }else{
    document.body.classList.remove("is-admin");
    status.innerHTML = "<b>Mode:</b> Public (Employee)";
    loginBox.style.display="flex";
    logoutBox.style.display="none";
  }
});

</script>

</body>
</html>
