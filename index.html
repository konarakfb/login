<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Daily Food Quality & Taste Check â€” Konarak F&B</title>

<!-- jsPDF + AutoTable -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

<style>
  body { font-family: Arial, sans-serif; background:#f6f6f6; padding:12px; }
  .container { max-width:980px; margin:auto; background:#fff; border:1px solid #ccc; padding:14px; box-sizing:border-box; }

  /* HEADER */
  .header { display:flex; align-items:center; gap:10px; }
  .header img { max-height:55px; width:auto; }
  .title { flex:1; text-align:center; font-size:18px; font-weight:700; white-space:nowrap; }

  /* METADATA GRID */
  .meta-grid { display:flex; flex-wrap:wrap; gap:10px; margin-top:12px; }
  .meta-item { flex:1 1 180px; min-width:140px; }
  .meta-item label { font-weight:700; display:block; margin-bottom:4px; }
  .meta-item input { width:100%; padding:8px; border:1px solid #999; border-radius:4px; }

  /* TABLE */
  .table-wrap { margin-top:14px; overflow-x:auto; }
  table { width:100%; min-width:1100px; border-collapse:collapse; }
  th, td { border:1px solid #aaa; padding:6px; font-size:13px; text-align:center; }
  th { background:#eee; }
  table input, table select { width:95%; padding:6px; }

  /* BUTTONS */
  .controls { display:flex; gap:10px; margin-top:12px; }
  .btn-add { background:#28a745; color:#fff; padding:10px; border:none; border-radius:4px; }
  .btn-save { background:#0d6efd; color:#fff; padding:10px; border:none; border-radius:4px; }
  .btn-pdf { background:#ff9800; color:#fff; padding:14px; border:none; border-radius:4px; width:100%; }

  .btn-del { background:#d9534f; color:#fff; padding:6px 8px; border:none; border-radius:4px; }

  /* NOTES */
  .notes-row { display:flex; flex-wrap:wrap; gap:10px; margin-top:14px; }
  .note-box { flex:1 1 300px; border:1px solid #999; padding:10px; min-height:90px; }
  .note-box h4 { margin:0 0 6px 0; font-size:14px; }
  .note-box p { white-space:pre-wrap; min-height:50px; margin:0; }

  /* FOOTER SIGNATURE */
  .footer-signature {
    display:flex; gap:20px; margin-top:18px;
  }
  .sig-box {
    flex:1; border:1px solid #999; padding:12px; min-height:70px;
    font-weight:700;
  }

  /* RESPONSIVE */
  @media(max-width:600px){
    table{ min-width:900px; }
    .header img { max-height:42px; }
    .title{ font-size:16px; white-space:normal; }
  }
</style>
</head>
<body>

<div class="container">

  <!-- HEADER -->
  <div class="header">
    <img src="logo.png" id="logoImg" alt="Logo" onerror="this.style.display='none'">
    <div class="title">Daily Food Quality &amp; Taste Check Report</div>
  </div>

  <!-- METADATA -->
  <div class="meta-grid">
    <div class="meta-item">
      <label>Date</label>
      <input type="date" id="date">
    </div>
    <div class="meta-item">
      <label>Building</label>
      <input id="building" type="text">
    </div>
    <div class="meta-item">
      <label>Floor</label>
      <input id="floor" type="text">
    </div>
    <div class="meta-item">
      <label>Counter</label>
      <input id="counter" type="text">
    </div>
    <div class="meta-item">
      <label>Supervisor</label>
      <input id="supervisor" type="text">
    </div>
    <div class="meta-item">
      <label>CBRE Representative</label>
      <input id="cbre" type="text">
    </div>
  </div>

  <!-- TABLE -->
  <div class="table-wrap">
    <table id="foodTable">
      <thead>
        <tr>
          <th>S.No</th>
          <th>Item</th>
          <th>Temp</th>
          <th>Freshness</th>
          <th>Taste</th>
          <th>Texture</th>
          <th>Appearance</th>
          <th>Portion</th>
          <th style="width:260px;">Remarks</th>
          <th>Del</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>1</td>
          <td><input></td>
          <td><input></td>
          <td><select><option>Good</option><option>Average</option><option>Poor</option></select></td>
          <td><select><option>Good</option><option>Average</option><option>Poor</option></select></td>
          <td><select><option>Soft</option><option>Normal</option><option>Hard</option></select></td>
          <td><select><option>Good</option><option>Average</option><option>Poor</option></select></td>
          <td><select><option>Std</option><option>Less</option></select></td>
          <td><input></td>
          <td><button class="btn-del" onclick="deleteRow(this)">X</button></td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- BUTTONS -->
  <div class="controls">
    <button class="btn-add" onclick="addRow()">+ Add Row</button>
    <button class="btn-save" onclick="alert('Saved')">Save</button>
  </div>

  <!-- NOTES -->
  <div class="notes-row">
    <div class="note-box">
      <h4>Taste Validation Notes</h4>
      <p id="tasteNotes"></p>
    </div>
    <div class="note-box">
      <h4>Special Observations</h4>
      <p id="obsNotes"></p>
    </div>
    <div class="note-box">
      <h4>Corrective Actions</h4>
      <p id="actNotes"></p>
    </div>
  </div>

  <!-- FOOTER SIGNATURE -->
  <div class="footer-signature">
    <div class="sig-box">Vendor PoC :</div>
    <div class="sig-box">Verified by F&amp;B Team :</div>
  </div>

  <!-- PDF BUTTON -->
  <button class="btn-pdf" onclick="downloadPDF()">Download PDF</button>

</div>

<script>

/* ------------------- ADD / DELETE ROW ------------------- */
function addRow(){
  const tbody = document.querySelector("#foodTable tbody");
  const i = tbody.rows.length + 1;
  const tr = document.createElement("tr");
  tr.innerHTML = `
    <td>${i}</td>
    <td><input></td>
    <td><input></td>
    <td><select><option>Good</option><option>Average</option><option>Poor</option></select></td>
    <td><select><option>Good</option><option>Average</option><option>Poor</option></select></td>
    <td><select><option>Soft</option><option>Normal</option><option>Hard</option></select></td>
    <td><select><option>Good</option><option>Average</option><option>Poor</option></select></td>
    <td><select><option>Std</option><option>Less</option></select></td>
    <td><input></td>
    <td><button class="btn-del" onclick="deleteRow(this)">X</button></td>`;
  tbody.appendChild(tr);
}

function deleteRow(btn){
  btn.parentElement.parentElement.remove();
  const rows = document.querySelectorAll("#foodTable tbody tr");
  rows.forEach((r,i)=>r.cells[0].innerText=i+1);
}

/* ------------------- PDF GENERATION ------------------- */
async function downloadPDF(){
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({ orientation:"landscape", unit:"pt", format:"a4" });

  const margin = 20;
  const pageWidth = doc.internal.pageSize.getWidth();
  const usableWidth = pageWidth - margin*2;
  let y = margin;

  /* ------ LOGO (medium size, proportional) ------ */
  const logoEl = document.getElementById("logoImg");
  let logoData = null;
  if(logoEl && logoEl.src && logoEl.style.display !== 'none'){
    logoData = await loadLogo(logoEl.src);
  }

  if(logoData){
    const H = 55; // medium height
    const W = logoData.width * (H / logoData.height);
    doc.addImage(logoData.data, "PNG", margin, y, W, H);
  }

  /* ------ TITLE ------ */
  doc.setFontSize(16);
  doc.setFont("helvetica","bold");
  doc.text("Daily Food Quality & Taste Check Report", pageWidth/2, y+32, {align:"center"});

  y += 70;

  /* ------ METADATA ------ */
  const meta = [
    ["Date", document.getElementById("date").value],
    ["Building", document.getElementById("building").value],
    ["Floor", document.getElementById("floor").value],
    ["Counter", document.getElementById("counter").value],
    ["Supervisor", document.getElementById("supervisor").value],
    ["CBRE Rep", document.getElementById("cbre").value]
  ];

  doc.autoTable({
    startY: y,
    head: [["Field","Value"]],
    body: meta,
    margin:{left:margin,right:margin},
    styles:{fontSize:10},
    columnStyles:{0:{cellWidth:80}, 1:{cellWidth:usableWidth-80}}
  });

  y = doc.lastAutoTable.finalY + 15;

  /* ------ TABLE ROWS ------ */
  const rows = [...document.querySelectorAll("#foodTable tbody tr")].map((tr,i)=>{
    const td = tr.querySelectorAll("td");
    return [
      i+1,
      td[1].querySelector("input").value,
      td[2].querySelector("input").value,
      td[3].querySelector("select").value,
      td[4].querySelector("select").value,
      td[5].querySelector("select").value,
      td[6].querySelector("select").value,
      td[7].querySelector("select").value,
      td[8].querySelector("input").value
    ];
  });

  doc.autoTable({
    startY: y,
    head: [["S.No","Item","Temp","Freshness","Taste","Texture","Appearance","Portion","Remarks"]],
    body: rows,
    margin:{left:margin, right:margin},
    styles:{fontSize:9, cellPadding:4, halign:"center"},
    columnStyles:{
      0:{cellWidth:30},
      1:{cellWidth:160, halign:"left"},
      2:{cellWidth:50},
      3:{cellWidth:70},
      4:{cellWidth:60},
      5:{cellWidth:60},
      6:{cellWidth:70},
      7:{cellWidth:60},
      8:{cellWidth:200, overflow:"linebreak", halign:"left"}  // FIXED WRAPPING
    }
  });

  y = doc.lastAutoTable.finalY + 20;

  /* ------ THREE NOTES BOXES ------ */
  const notes = {
    taste: document.getElementById("tasteNotes").innerText,
    obs: document.getElementById("obsNotes").innerText,
    actions: document.getElementById("actNotes").innerText
  };

  const boxH = 70;

  drawBox(doc, margin, y, usableWidth, boxH, "Taste Validation Notes", notes.taste);
  y += boxH + 12;

  drawBox(doc, margin, y, usableWidth, boxH, "Special Observations", notes.obs);
  y += boxH + 12;

  drawBox(doc, margin, y, usableWidth, boxH, "Corrective Actions", notes.actions);
  y += boxH + 20;

  /* ------ SIGNATURE BOXES ------ */
  const half = (usableWidth - 20) / 2;
  doc.rect(margin, y, half, 60);
  doc.text("Vendor PoC :", margin + 10, y + 20);

  doc.rect(margin + half + 20, y, half, 60);
  doc.text("Verified by F&B Team :", margin + half + 30, y + 20);

  /* SAVE */
  doc.save("Food_Quality_Check.pdf");


  /* ---------- HELPERS ---------- */

  function drawBox(doc, x, y, w, h, title, text){
    doc.rect(x,y,w,h);
    doc.setFontSize(11);
    doc.setFont("helvetica","bold");
    doc.text(title, x+6, y+14);
    doc.setFont("helvetica","normal");
    doc.setFontSize(10);
    doc.text(doc.splitTextToSize(text, w-12), x+6, y+32);
  }

  function loadLogo(src){
    return new Promise((resolve)=>{
      const img=new Image();
      img.crossOrigin="anonymous";
      img.onload=function(){
        const canvas=document.createElement("canvas");
        canvas.width=this.width;
        canvas.height=this.height;
        canvas.getContext("2d").drawImage(this,0,0);
        resolve({data:canvas.toDataURL("image/png"), width:this.width, height:this.height});
      };
      img.onerror=()=>resolve(null);
      img.src=src;
    });
  }
}

</script>

</body>
</html>
