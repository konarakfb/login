<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Daily Food Quality & Taste Check — Konarak F&B</title>

<!-- jsPDF + AutoTable -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

<style>
  body{
    font-family:Arial,Helvetica,sans-serif;
    background:#f3f3f3;
    padding:18px;
    margin:0;
  }
  .page-wrap{ max-width:1000px; margin:auto; }
  .sheet{ border:3px solid #222; background:#fff; padding:12px; }
  .inner-box{ border:2px solid #222; padding:12px; }

  /* HEADER – small logo like Sales Report */
  .header{
    position:relative;
    display:flex;
    align-items:center;
    height:60px;
  }
  .logo{
    flex:0 0 auto;
    display:flex;
    align-items:center;
  }
  .logo img{
    height:36px;
    width:auto;
    object-fit:contain;
  }
  @media(max-width:600px){
    .logo img{ height:32px; }
  }
  .title{
    position:absolute; left:50%; transform:translateX(-50%);
    font-size:20px; font-weight:700; text-align:center;
  }
  .header-right{ flex:0 0 150px; }
  .header-line{
    border-bottom:2px solid #222;
    margin-top:10px; margin-bottom:10px;
  }

  /* METADATA */
  .meta-box{ border:1px solid #222; padding:8px; }
  .meta-row{ display:flex; flex-wrap:wrap; gap:10px; margin-bottom:10px; }
  .meta-item{
    flex:1 1 30%;
    border:1px solid #999;
    padding:10px;
    display:flex;
    align-items:center;
    gap:6px;
    min-height:48px;
    box-sizing:border-box;
  }
  .meta-item label{
    font-weight:700;
    font-size:13px;
    flex-shrink:0;
    width:110px;
  }
  .meta-item input{
    flex:1; min-width:0;
    padding:8px;
    border:1px solid #bbb;
    border-radius:3px;
    font-size:14px;
    box-sizing:border-box;
  }

  /* TABLE */
  .table-wrap{ margin-top:14px; overflow:auto; }
  table{
    width:100%; border-collapse:collapse; min-width:1100px;
  }
  th,td{
    border:1px solid #222;
    padding:6px;
    font-size:13px;
  }
  th{ background:#eee; font-weight:700; }
  td input,td select{
    width:100%; padding:6px;
    border:1px solid #bbb; border-radius:3px;
    font-size:13px; box-sizing:border-box;
  }
  .after-table-gap{ height:16px; }

  /* NOTES – FIXED padding/width so not crossing line */
  .notes-area{
    display:flex;
    gap:8px;
    flex-wrap:wrap;
    width:100%;
    box-sizing:border-box;
  }
  .note-box{
    flex:1 1 calc(33.33% - 8px);
    border:1px solid #222;
    padding:6px;                       /* smaller padding */
    box-sizing:border-box;              /* IMPORTANT */
    min-height:82px;
    background:#fff;
  }
  .note-box label{
    font-weight:700;
    margin-bottom:4px;
    display:block;
    font-size:13px;
  }
  .note-box textarea{
    width:100%;
    min-height:58px;
    resize:vertical;
    padding:6px;
    border:1px solid #bbb;
    border-radius:3px;
    font-size:13px;
    box-sizing:border-box;
  }

  /* FOOTER */
  .footer-box{
    margin-top:12px;
    border:1px solid #222;
    display:flex;
  }
  .footer-half{
    flex:1;
    border-right:1px solid #ddd;
    padding:10px;
    box-sizing:border-box;
  }
  .footer-half:last-child{ border-right:none; }
  .footer-half input{
    width:95%;
    padding:8px;
    border:1px solid #bbb;
    border-radius:3px;
    font-size:14px;
    box-sizing:border-box;
  }

  /* BUTTONS AT BOTTOM */
  .buttons{ display:flex; gap:12px; flex-wrap:wrap; margin-top:14px; }
  .btn{
    padding:10px 16px; color:#fff; border:none;
    border-radius:6px; font-weight:700; cursor:pointer;
  }
  .btn-add{ background:#0d6efd; }
  .btn-save{ background:#198754; }
  .btn-pdf{ background:#6f42c1; }
  .btn-reset{ background:#d9534f; }

</style>
</head>
<body>

<div class="page-wrap">
  <div class="sheet">
    <div class="inner-box">

      <!-- HEADER -->
      <div class="header">
        <div class="logo"><img id="logoImg" src="logo.png" alt="Logo"></div>
        <div class="title">Daily Food Quality &amp; Taste Check Report</div>
        <div class="header-right"></div>
      </div>

      <div class="header-line"></div>

      <!-- METADATA -->
      <div class="meta-box">
        <div class="meta-row">
          <div class="meta-item"><label>Date:</label><input id="date" type="date"></div>
          <div class="meta-item"><label>Vendor Name:</label><input id="vendorName" type="text"></div>
          <div class="meta-item"><label>Vendor Supervisor:</label><input id="vendorSupervisor" type="text"></div>
        </div>

        <div class="meta-row">
          <div class="meta-item"><label>Building:</label><input id="building" type="text"></div>
          <div class="meta-item"><label>Floor:</label><input id="floor" type="text"></div>
          <div class="meta-item"><label>Counter:</label><input id="counter" type="text"></div>
        </div>
      </div>

      <!-- TABLE -->
      <div class="table-wrap">
        <table id="foodTable">
          <thead>
            <tr>
              <th style="width:40px;">S.No</th>
              <th style="width:260px;">Item</th>
              <th style="width:90px;">Temp (°C)</th>
              <th style="width:120px;">Freshness</th>
              <th style="width:110px;">Taste</th>
              <th style="width:110px;">Texture</th>
              <th style="width:110px;">Appearance</th>
              <th style="width:100px;">Portion</th>
              <th style="width:260px;">Remarks</th>
              <th style="width:50px;">Del</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>1</td>
              <td><input></td>
              <td><input></td>
              <td><select><option>Good</option><option>Average</option><option>Poor</option></select></td>
              <td><select><option>Good</option><option>Average</option><option>Poor</option></select></td>
              <td><select><option>Soft</option><option>Normal</option><option>Hard</option></select></td>
              <td><select><option>Good</option><option>Average</option><option>Poor</option></select></td>
              <td><select><option>Std</option><option>Less</option></select></td>
              <td><input></td>
              <td><button onclick="deleteRow(this)" class="btn btn-reset" style="padding:4px 6px;">X</button></td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="after-table-gap"></div>

      <!-- NOTES -->
      <div class="notes-area">
        <div class="note-box">
          <label>Taste Validation Notes</label>
          <textarea id="tasteNotes"></textarea>
        </div>
        <div class="note-box">
          <label>Special Observations</label>
          <textarea id="obsNotes"></textarea>
        </div>
        <div class="note-box">
          <label>Corrective Actions</label>
          <textarea id="actNotes"></textarea>
        </div>
      </div>

      <!-- FOOTER -->
      <div class="footer-box">
        <div class="footer-half">
          <label style="font-weight:700;display:block;margin-bottom:6px;">Vendor PoC :</label>
          <input id="vendorPoc" type="text">
        </div>
        <div class="footer-half">
          <label style="font-weight:700;display:block;margin-bottom:6px;">Verified by F&amp;B Team :</label>
          <input id="verifiedBy" type="text">
        </div>
      </div>

    </div><!-- inner-box -->
  </div><!-- sheet -->

  <!-- BUTTONS -->
  <div class="buttons">
    <button class="btn btn-add" onclick="addRow()">Add Row</button>
    <button class="btn btn-save" onclick="saveForm()">Save</button>
    <button class="btn btn-pdf" onclick="downloadPDF()">Download PDF</button>
    <button class="btn btn-reset" onclick="resetForm()">Reset</button>
  </div>

</div>

<script>
function deleteRow(btn){
  let tr=btn.closest("tr");
  tr.remove();
  document.querySelectorAll("#foodTable tbody tr").forEach((r,i)=>r.cells[0].innerText=i+1);
}

function addRow(){
  const tbody=document.querySelector("#foodTable tbody");
  let i=tbody.rows.length+1;
  let tr=document.createElement("tr");
  tr.innerHTML=`
    <td>${i}</td>
    <td><input></td>
    <td><input></td>
    <td><select><option>Good</option><option>Average</option><option>Poor</option></select></td>
    <td><select><option>Good</option><option>Average</option><option>Poor</option></select></td>
    <td><select><option>Soft</option><option>Normal</option><option>Hard</option></select></td>
    <td><select><option>Good</option><option>Average</option><option>Poor</option></select></td>
    <td><select><option>Std</option><option>Less</option></select></td>
    <td><input></td>
    <td><button onclick="deleteRow(this)" class="btn btn-reset" style="padding:4px 6px;">X</button></td>
  `;
  tbody.appendChild(tr);
}

/* -------------- PDF GENERATION -------------- */
async function downloadPDF(){
  const { jsPDF }=window.jspdf;
  const doc=new jsPDF({orientation:"landscape",unit:"pt",format:"a4"});
  const margin=22;
  const pageW=doc.internal.pageSize.getWidth();
  const usable=pageW - margin*2;
  let y=margin;

  // load logo
  let logoEl=document.getElementById("logoImg");
  let logo=await loadImage(logoEl.src);

  if(logo){
    const targetH=42;
    const scale=targetH/logo.height;
    let w=logo.width*scale;
    let h=targetH;

    let maxW=usable*0.28;
    if(w>maxW){
      const s=maxW/w;
      w*=s; h*=s;
    }
    doc.addImage(logo.data,"PNG",margin,y,w,h);
  }

  doc.setFont("helvetica","bold");
  doc.setFontSize(18);
  doc.text("Daily Food Quality & Taste Check Report",pageW/2,y+26,{align:"center"});

  y+=60;
  doc.line(margin,y-6,pageW-margin,y-6);

  const meta=[
    ["Date",document.getElementById("date").value],
    ["Vendor Name",document.getElementById("vendorName").value],
    ["Vendor Supervisor",document.getElementById("vendorSupervisor").value],
    ["Building",document.getElementById("building").value],
    ["Floor",document.getElementById("floor").value],
    ["Counter",document.getElementById("counter").value]
  ];

  doc.setFontSize(10);
  const colW=(usable-10)/3;

  let x=margin;
  for(let i=0;i<3;i++){
    doc.rect(x,y,colW,34);
    doc.text(meta[i][0]+":",x+6,y+12);
    doc.text(doc.splitTextToSize(meta[i][1],colW-12),x+6,y+26);
    x+=colW+5;
  }
  y+=40;
  x=margin;
  for(let i=3;i<6;i++){
    doc.rect(x,y,colW,34);
    doc.text(meta[i][0]+":",x+6,y+12);
    doc.text(doc.splitTextToSize(meta[i][1],colW-12),x+6,y+26);
    x+=colW+5;
  }
  y+=46;

  const rows=[...document.querySelectorAll("#foodTable tbody tr")].map((tr,i)=>{
    const c=tr.querySelectorAll("td");
    return [
      i+1,
      c[1].querySelector("input").value,
      c[2].querySelector("input").value,
      c[3].querySelector("select").value,
      c[4].querySelector("select").value,
      c[5].querySelector("select").value,
      c[6].querySelector("select").value,
      c[7].querySelector("select").value,
      c[8].querySelector("input").value
    ];
  });

  doc.autoTable({
    head:[["S.No","Item","Temp (°C)","Freshness","Taste","Texture","Appearance","Portion","Remarks"]],
    body:rows,
    startY:y,
    margin:{left:margin+5,right:margin+5},
    theme:"grid",
    styles:{fontSize:10,cellPadding:6,lineWidth:0.7,lineColor:[0,0,0]},
    headStyles:{fillColor:[230,230,230],fontStyle:"bold",lineWidth:1,lineColor:[0,0,0]},
    columnStyles:{
      0:{cellWidth:36},
      1:{cellWidth:220},
      2:{cellWidth:60},
      3:{cellWidth:70},
      4:{cellWidth:70},
      5:{cellWidth:70},
      6:{cellWidth:70},
      7:{cellWidth:60},
      8:{cellWidth:usable-(36+220+60+70+70+70+70+60)-40, overflow:"linebreak"}
    }
  });

  y=doc.lastAutoTable.finalY+18;

  const notes=[
    ["Taste Validation Notes",document.getElementById("tasteNotes").value],
    ["Special Observations",document.getElementById("obsNotes").value],
    ["Corrective Actions",document.getElementById("actNotes").value]
  ];

  const gap=10;
  const bw=(usable-gap*2)/3;
  const bh=72;
  let nx=margin;

  notes.forEach(n=>{
    doc.rect(nx,y,bw,bh);
    doc.text(n[0],nx+6,y+14);
    doc.text(doc.splitTextToSize(n[1],bw-12),nx+6,y+30);
    nx+=bw+gap;
  });

  y+=bh+16;

  const vendor=document.getElementById("vendorPoc").value;
  const fb=document.getElementById("verifiedBy").value;

  doc.rect(margin,y,usable,60);
  doc.line(margin+usable/2,y,margin+usable/2,y+60);
  doc.text("Vendor PoC : "+vendor,margin+10,y+26);
  doc.text("Verified by F&B Team : "+fb,margin+usable/2+10,y+26);

  doc.save("Food_Quality_Check.pdf");

  function loadImage(src){
    return new Promise(res=>{
      const img=new Image();
      img.crossOrigin="anonymous";
      img.onload=function(){
        const c=document.createElement("canvas");
        c.width=this.width; c.height=this.height;
        c.getContext("2d").drawImage(this,0,0);
        res({data:c.toDataURL("image/png"),width:this.width,height:this.height});
      };
      img.onerror=()=>res(null);
      img.src=src;
    });
  }
}
</script>

</body>
</html>
